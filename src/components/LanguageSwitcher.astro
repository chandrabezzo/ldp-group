---
import { getLanguageFromURL } from '../utils/i18n';

const currentLang = getLanguageFromURL(Astro.url.pathname);
---

<div class="language-switcher">
	<button class="lang-btn" data-locale="id" class:list={[{ active: currentLang === 'id' }]}>
		ðŸ‡®ðŸ‡© ID
	</button>
	<button class="lang-btn" data-locale="en" class:list={[{ active: currentLang === 'en' }]}>
		ðŸ‡¬ðŸ‡§ EN
	</button>
</div>

<style>
	.language-switcher {
		display: flex;
		gap: calc(var(--spacing-unit) * 1);
		align-items: center;
		background: var(--color-bg-light);
		padding: 4px;
		border-radius: 8px;
		border: 1px solid var(--color-border);
	}

	.lang-btn {
		padding: calc(var(--spacing-unit) * 1) calc(var(--spacing-unit) * 2);
		border: none;
		background: transparent;
		color: var(--color-text);
		font-weight: 500;
		font-size: 0.9rem;
		border-radius: 6px;
		cursor: pointer;
		transition: var(--transition);
		font-family: inherit;
		display: flex;
		align-items: center;
		gap: 4px;
	}

	.lang-btn:hover {
		background: white;
	}

	.lang-btn.active {
		background: var(--color-primary);
		color: white;
	}

	@media (max-width: 768px) {
		.language-switcher {
			order: 2;
		}
	}
</style>

<script>
	const langButtons = document.querySelectorAll('.lang-btn');

	langButtons.forEach(button => {
		button.addEventListener('click', () => {
			const targetLocale = button.getAttribute('data-locale') as 'id' | 'en';
			if (targetLocale) {
				const currentPath = window.location.pathname;
				let newPath: string;

				// Remove /en prefix if switching to Indonesian
				if (targetLocale === 'id') {
					newPath = currentPath.replace(/^\/en(\/|$)/, '/') || '/';
				} 
				// Add /en prefix if switching to English
				else {
					if (currentPath === '/' || currentPath === '') {
						newPath = '/en';
					} else if (currentPath.startsWith('/en')) {
						newPath = currentPath; // Already on English page
					} else {
						newPath = `/en${currentPath}`;
					}
				}

				// Navigate to the new path
				window.location.href = newPath;
			}
		});
	});
</script>
